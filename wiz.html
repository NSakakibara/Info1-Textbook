<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”æ³•ä½¿ã„ã®ãƒãƒ¼ã‚·ãƒ§ãƒ³èª¿åˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kiwi Maru', serif;
            touch-action: none; /* Disable pinch zoom on mobile */
        }
        .bg-magic {
            background-color: #1a202c;
            background-image:
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05), transparent 60%),
                radial-gradient(circle at 10% 20%, rgba(128, 0, 128, 0.2), transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 128, 128, 0.2), transparent 40%);
        }
        .recipe-scroll {
            background-color: #f5e8c7;
            border: 8px solid #a17a4a;
            border-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z' fill='%23a17a4a'/%3E%3C/svg%3E") 8;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .ingredient {
            cursor: grab;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .ingredient:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 100, 0.7);
        }
        .dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .cauldron-drop-zone.dragover {
            transform: scale(1.05);
            box-shadow: 0 0 30px 10px rgba(72, 255, 201, 0.7);
        }

        /* Animations */
        @keyframes sparkle {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        .sparkle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: gold;
            border-radius: 50%;
            pointer-events: none;
            animation: sparkle 0.7s ease-out;
        }

        @keyframes smoke {
            0% { transform: scale(0.5) translateY(0); opacity: 0; }
            50% { opacity: 0.6; }
            100% { transform: scale(1.5) translateY(-50px); opacity: 0; }
        }
        .smoke {
            position: absolute;
            width: 80px;
            height: 80px;
            background: #888;
            border-radius: 50%;
            pointer-events: none;
            animation: smoke 1s ease-out forwards;
        }
        @keyframes frog-jump {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            30% { transform: translateY(-80px) scale(1) rotate(-15deg); opacity: 1; }
            100% { transform: translateY(50px) scale(1.2) rotate(15deg); opacity: 0; }
        }
        .frog-jump {
            position: absolute;
            font-size: 4rem;
            pointer-events: none;
            animation: frog-jump 0.8s ease-in-out forwards;
        }
    </style>
</head>
<body class="bg-magic text-white min-h-screen flex items-center justify-center p-4">

    <div id="game-container" class="w-full max-w-5xl mx-auto text-center">
        <!-- Header -->
        <h1 class="text-4xl font-bold mb-2 text-yellow-300" style="text-shadow: 2px 2px 4px #000;">é­”æ³•ä½¿ã„ã®ãƒãƒ¼ã‚·ãƒ§ãƒ³èª¿åˆ</h1>
        <p class="text-lg mb-6">å¸«åŒ ã®ãƒ¬ã‚·ãƒ”é€šã‚Šã«ã€ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Œæˆã•ã›ã‚‹ã®ã˜ã‚ƒï¼</p>

        <div class="flex flex-col lg:flex-row gap-8 items-center justify-between">
            <!-- Recipe Section -->
            <div id="recipe-section" class="w-full lg:w-1/3">
                <h2 class="text-2xl font-bold mb-3 text-yellow-200">ğŸ“œ é­”æ³•ã®ãƒ¬ã‚·ãƒ”</h2>
                <div class="recipe-scroll p-6 rounded-lg text-gray-800">
                    <ul id="recipe-list" class="text-left space-y-3">
                        <!-- Recipe items will be generated here -->
                    </ul>
                </div>
            </div>

            <!-- Cauldron Section -->
            <div id="cauldron-section" class="relative w-full lg:w-1/3 flex flex-col items-center">
                 <div id="animation-area" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>
                 <div class="cauldron-drop-zone w-48 h-40 bg-gray-800 border-4 border-gray-600 rounded-t-full rounded-b-lg flex items-center justify-center transition-all duration-300"
                    style="box-shadow: 0 10px 15px rgba(0,0,0,0.5) inset;">
                    <div class="w-40 h-32 bg-purple-800 rounded-t-full rounded-b-md opacity-75 relative overflow-hidden">
                       <div class="absolute bottom-0 left-0 w-full h-1/3 bg-purple-600 rounded-full animate-pulse"></div>
                    </div>
                </div>
                <div class="text-2xl mt-2">ğŸ§ª å¤§é‹</div>
            </div>
        </div>

        <!-- Ingredients Shelf -->
        <div id="shelf-section" class="mt-10">
            <h2 class="text-2xl font-bold mb-4 text-yellow-200">ğŸŒ¿ ææ–™æ£š</h2>
            <div id="ingredients-shelf" class="bg-yellow-900/50 p-4 rounded-lg grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-4 border-2 border-yellow-800">
                <!-- Ingredients will be generated here -->
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 border-4 border-yellow-500 rounded-lg p-8 text-center max-w-md w-full relative">
             <img src="https://placehold.co/100x100/7a4a2a/f5e8c7?text=ğŸ§™â€â™‚ï¸" alt="å¸«åŒ " class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-yellow-300">
            <h2 id="modal-title" class="text-3xl font-bold mb-4 text-yellow-300"></h2>
            <p id="modal-message" class="text-lg mb-6"></p>
            <button id="restart-button" class="bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-6 rounded-lg text-xl shadow-lg transform hover:scale-105 transition-transform">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Game Data ---
            const allIngredients = [
                // Correct ingredients pool
                { id: 'red-fire', name: 'èµ¤ã„æ¶²ä½“', color: 'bg-red-500', symbol: 'ğŸ”¥', isCorrect: true },
                { id: 'green-leaf', name: 'ç·‘ã®ç²‰', color: 'bg-green-500', symbol: 'ğŸƒ', isCorrect: true },
                { id: 'blue-water', name: 'é’ã„æ¶²ä½“', color: 'bg-blue-500', symbol: 'ğŸ’§', isCorrect: true },
                { id: 'yellow-star', name: 'é»„ã®çµæ™¶', color: 'bg-yellow-400', symbol: 'â­', isCorrect: true },
                { id: 'purple-moon', name: 'ç´«ã®æ¶²ä½“', color: 'bg-purple-500', symbol: 'ğŸŒ™', isCorrect: true },
                { id: 'orange-feather', name: 'æ©™ã®ç¾½æ ¹', color: 'bg-orange-500', symbol: 'ğŸª¶', isCorrect: true },

                // Decoys
                { id: 'red-water', name: 'èµ¤é»’ã„æ¶²ä½“', color: 'bg-red-800', symbol: 'ğŸ’§' },
                { id: 'green-skull', name: 'æ·±ç·‘ã®ç²‰', color: 'bg-green-800', symbol: 'ğŸ’€' },
                { id: 'blue-moon', name: 'è—è‰²ã®æ¶²ä½“', color: 'bg-blue-800', symbol: 'ğŸŒ™' },
                { id: 'yellow-skull', name: 'é»„åœŸã®çµæ™¶', color: 'bg-yellow-700', symbol: 'ğŸ’€' },
                { id: 'red-leaf', name: 'æš—ã„èµ¤ã®æ¶²ä½“', color: 'bg-red-700', symbol: 'ğŸƒ' },
                { id: 'green-fire', name: 'é»„ç·‘ã®ç²‰', color: 'bg-lime-400', symbol: 'ğŸ”¥' },
                { id: 'purple-star', name: 'æ¿ƒç´«ã®æ¶²ä½“', color: 'bg-purple-800', symbol: 'â­' },
                { id: 'orange-skull', name: 'æ¿ã£ãŸæ©™ã®ç²‰', color: 'bg-orange-800', symbol: 'ğŸ’€' },
                { id: 'white-skull', name: 'ç™½ã„éª¨', color: 'bg-gray-200 text-black', symbol: 'ğŸ’€' },
                { id: 'black-fire', name: 'é»’ã„ç°', color: 'bg-gray-900', symbol: 'ğŸ”¥' },
            ];

            let recipe = [];
            const RECIPE_LENGTH = 4; // Increased recipe length

            let currentStep = 0;
            let draggedIngredientId = null;

            // --- DOM Elements ---
            const recipeList = document.getElementById('recipe-list');
            const ingredientsShelf = document.getElementById('ingredients-shelf');
            const cauldronDropZone = document.querySelector('.cauldron-drop-zone');
            const animationArea = document.getElementById('animation-area');
            const resultModal = document.getElementById('result-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const restartButton = document.getElementById('restart-button');

            // --- Game Logic ---
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function generateRecipe() {
                const correctIngredients = allIngredients.filter(ing => ing.isCorrect);
                const shuffled = shuffleArray([...correctIngredients]);
                recipe = shuffled.slice(0, RECIPE_LENGTH);
            }

            function setupGame(isEasyMode = false) {
                currentStep = 0;
                draggedIngredientId = null;

                // Generate a new random recipe
                generateRecipe();

                // Render Recipe
                renderRecipe();

                // Render Ingredients
                ingredientsShelf.innerHTML = '';
                const shuffledIngredients = shuffleArray([...allIngredients]);
                shuffledIngredients.forEach(ing => {
                    const ingElement = document.createElement('div');
                    ingElement.id = ing.id;
                    ingElement.draggable = true;
                    ingElement.className = 'ingredient p-2 bg-gray-700 rounded-lg flex flex-col items-center justify-center aspect-square text-center';
                    
                    if (isEasyMode) {
                        // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¢ã‚¤ã‚³ãƒ³ã¨æ–‡å­—ã‚’è¡¨ç¤º
                        ingElement.innerHTML = `
                            <div class="w-10 h-10 ${ing.color} rounded-full border-2 border-gray-400 flex items-center justify-center text-3xl mb-1">
                                ${ing.symbol}
                            </div>
                            <div class="text-xs leading-tight">${ing.name}</div>
                        `;
                    } else {
                        // é«˜é›£æ˜“åº¦ãƒ¢ãƒ¼ãƒ‰ï¼šè‰²ã®ã¿è¡¨ç¤º
                        ingElement.innerHTML = `
                            <div class="w-full h-full ${ing.color} rounded-full border-2 border-gray-400">
                            </div>
                        `;
                    }

                    ingElement.addEventListener('dragstart', handleDragStart);
                    ingElement.addEventListener('dragend', handleDragEnd);
                    ingredientsShelf.appendChild(ingElement);
                });
                
                resultModal.classList.add('hidden');
            }

            function renderRecipe() {
                recipeList.innerHTML = '';
                recipe.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = `transition-all duration-300 p-2 rounded ${index < currentStep ? 'opacity-50 line-through' : ''} ${index === currentStep ? 'bg-yellow-200 font-bold' : ''}`;
                    li.innerHTML = `<span>${index + 1}. ${item.name} ${item.symbol}</span>`;
                    recipeList.appendChild(li);
                });
            }

            function handleIngredientDrop() {
                const requiredIngredient = recipe[currentStep];

                if (draggedIngredientId === requiredIngredient.id) {
                    // Correct ingredient
                    playSuccessAnimation();
                    currentStep++;
                    renderRecipe();

                    if (currentStep >= recipe.length) {
                        setTimeout(() => showGameResult(true), 500);
                    }
                } else {
                    // Incorrect ingredient
                    playFailureAnimation();
                    setTimeout(() => showGameResult(false), 500);
                }
            }
            
            function showGameResult(isSuccess) {
                if (isSuccess) {
                    modalTitle.textContent = 'ğŸ‰ ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Œæˆï¼ ğŸ‰';
                    modalMessage.textContent = 'ç´ æ™´ã‚‰ã—ã„ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œæˆã—ãŸãï¼æ­£ã—ã„ææ–™ã‚’ã€æ­£ã—ã„æ‰‹é †ã§ä½¿ã†ã€‚ã“ã‚ŒãŒä¸€æµã®é­”æ³•ä½¿ã„ã¸ã®é“ã˜ã‚ƒï¼';
                    restartButton.textContent = 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦';
                    restartButton.onclick = () => {
                        resultModal.classList.add('hidden');
                        setupGame(false); // æ¬¡ã‚‚é«˜é›£æ˜“åº¦ã§æŒ‘æˆ¦
                    };
                } else {
                    modalTitle.textContent = 'ğŸ’¥ èª¿åˆå¤±æ•—ï¼ ğŸ’¥';
                    modalMessage.textContent = 'å¤±æ•—ã˜ã‚ƒãªã€‚è‰²ã ã‘ã§åˆ¤æ–­ã™ã‚‹ã®ã¯é›£ã—ã„ã˜ã‚ƒã‚ï¼Ÿæ™®æ®µã‹ã‚‰ãƒ©ãƒ™ãƒ«ã«æ–‡å­—ã‚„ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ã—ã¦åŒºåˆ¥ã—ã‚„ã™ãã—ã¦ãŠãã®ãŒå¤§åˆ‡ãªã‚“ã˜ã‚ƒã€‚ã‚ˆã—ã€ä»Šå›ã¯å„‚ãŒãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ ã—ã¦ã‚„ã‚ã†ã€‚ã“ã‚Œã§å†æŒ‘æˆ¦ã—ã¦ã¿ã‚‹ãŒã‚ˆã„ï¼';
                    restartButton.textContent = 'ãƒ©ãƒ™ãƒ«ä»˜ãã§å†æŒ‘æˆ¦';
                     restartButton.onclick = () => {
                        resultModal.classList.add('hidden');
                        setupGame(true); // æ¬¡ã¯é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§æŒ‘æˆ¦
                    };
                }
                resultModal.classList.remove('hidden');
            }


            // --- Animations ---
            function playSuccessAnimation() {
                for (let i = 0; i < 15; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = `${Math.random() * 100}%`;
                    sparkle.style.top = `${Math.random() * 100}%`;
                    sparkle.style.animationDelay = `${Math.random() * 0.5}s`;
                    animationArea.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1000);
                }
            }
            
            function playFailureAnimation() {
                const failureType = Math.random() > 0.5 ? 'smoke' : 'frog';

                if (failureType === 'smoke') {
                    const smoke = document.createElement('div');
                    smoke.className = 'smoke';
                    animationArea.appendChild(smoke);
                    setTimeout(() => smoke.remove(), 1000);
                } else {
                    const frog = document.createElement('div');
                    frog.className = 'frog-jump';
                    frog.textContent = 'ğŸ¸';
                    animationArea.appendChild(frog);
                    setTimeout(() => frog.remove(), 800);
                }
            }


            // --- Drag and Drop Event Handlers ---
            function handleDragStart(e) {
                draggedIngredientId = e.target.closest('.ingredient').id;
                e.target.closest('.ingredient').classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }

            function handleDragEnd(e) {
                e.target.closest('.ingredient').classList.remove('dragging');
            }
            
            cauldronDropZone.addEventListener('dragenter', (e) => {
                e.preventDefault();
                cauldronDropZone.classList.add('dragover');
            });
            
            cauldronDropZone.addEventListener('dragover', (e) => {
                e.preventDefault(); // Necessary to allow drop
            });

            cauldronDropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                cauldronDropZone.classList.remove('dragover');
            });

            cauldronDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                cauldronDropZone.classList.remove('dragover');
                handleIngredientDrop();
            });
            
            // --- Event Listeners ---
            // The restart button's event is now handled within showGameResult

            // --- Initial Setup ---
            setupGame(false); // æœ€åˆã¯é«˜é›£æ˜“åº¦ãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹
        });
    </script>
</body>
</html>


